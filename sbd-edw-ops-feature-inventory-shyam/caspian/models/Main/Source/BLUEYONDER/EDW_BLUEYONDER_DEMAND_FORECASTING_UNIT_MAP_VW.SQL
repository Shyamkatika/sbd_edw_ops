SELECT     
UPPER(CONCAT(COALESCE(DFUMAP.FROMDFULOC::VARCHAR,''),'~',COALESCE(DFUMAP.FROMDMDGROUP::VARCHAR,''),'~', COALESCE(DFUMAP.FROMDMDUNIT::VARCHAR,'')
,'~', COALESCE(DFUMAP.FROMMODEL::VARCHAR,''),'~', COALESCE(DFUMAP.MAP::VARCHAR,''),'~', COALESCE(DFUMAP.TODFULOC::VARCHAR,'')
,'~', COALESCE(DFUMAP.TODMDGROUP::VARCHAR,''),'~', COALESCE(DFUMAP.TODMDUNIT::VARCHAR,''),'~', COALESCE(DFUMAP.EFF::VARCHAR,''))) AS DMD_FORECASTING_UNIT_MAP_KEY,
'BLUEYONDER' as  {{var('column_srcsyskey')}},  
MD5(UPPER(CONCAT(COALESCE(DFUMAP.FROMDFULOC::VARCHAR,''),'~',COALESCE(DFUMAP.FROMDMDGROUP::VARCHAR,''),'~', COALESCE(DFUMAP.FROMDMDUNIT::VARCHAR,'')
,'~', COALESCE(DFUMAP.FROMMODEL::VARCHAR,''),'~', COALESCE(DFUMAP.MAP::VARCHAR,''),'~', COALESCE(DFUMAP.TODFULOC::VARCHAR,'')
,'~', COALESCE(DFUMAP.TODMDGROUP::VARCHAR,''),'~', COALESCE(DFUMAP.TODMDUNIT::VARCHAR,''),'~', COALESCE(DFUMAP.EFF::VARCHAR,'')))) AS {{var('column_rechashkey')}},
{{var('default_n')}} as {{var('column_DEL_FROM_SRC_FLAG')}},
'{{model.name}}' as {{var('column_ETL_INS_PID')}},
CURRENT_TIMESTAMP::TIMESTAMP_NTZ as {{var('column_ETL_INS_DTE')}},
'{{model.name}}' as {{var('column_ETL_UPD_PID')}},
CURRENT_TIMESTAMP::TIMESTAMP_NTZ as {{var('column_ETL_UPD_DTE')}},
DFUMAP.LOADDTS as {{var('column_z3loddtm')}},
DFUMAP.LOADDTS as  {{var('column_vereffdte')}},
'9999-12-31 00:00:00.000' as {{var('column_verexpirydt')}},
{{var('default_y')}} AS  {{var('column_currrecflag')}},                                                                                    
{{var('default_n')}} AS  {{var('column_orprecflag')}},
DFUMAP.DISC	AS	DFU_MAP_EXPR_DTE,
DFUMAP.EFF	AS	DFU_MAP_EFF_DTE,
DFUMAP.FROMDFULOC	AS	FROM_LOC_KEY,
DFUMAP.TODFULOC	AS	TO_LOC_KEY,
DFUMAP.FCSTTYPE	AS	FCST_TYP,
DFUMAP.HISTTYPE	AS	DFU_MODEL_HIST_TYP,
DFUMAP.LEVELNUM	AS	DFU_MAP_LVL_NBR,
DFUMAP.FROMDMDGROUP	AS	DMD_GRP_FROM_KEY,
DFUMAP.LOCKEND	AS	DFU_MODEL_FROM_LOCK_END_DTE,
DFUMAP.LOCKSTART	AS	DFU_MODEL_FROM_LOCK_START_DTE,
DFUMAP.FACTOR	AS	DFU_MODEL_TO_ALLOC_FACTOR_PCT,
DFUMAP.FROMMODEL	AS	MODEL_FROM_NAME,
DFUMAP.TOMODEL	AS	MODEL_TO_NAME,
DFUMAP.TODMDGROUP	AS	DMD_GRP_TO_KEY,
DFUMAP.FROMDMDUNIT	AS	DMD_UNIT_FROM_KEY,
DFUMAP.MAP	AS	MODEL_MAP_NAME,
DFUMAP.TODMDUNIT	AS	DMD_UNIT_TO_KEY
FROM {{source('BLUEYONDER','DFUMAP')}} DFUMAP
