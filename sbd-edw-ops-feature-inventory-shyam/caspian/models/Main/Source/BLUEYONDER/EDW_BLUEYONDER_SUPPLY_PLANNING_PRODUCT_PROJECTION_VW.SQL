WITH MAP AS 
(SELECT    distinct 
UPPER(CONCAT(COALESCE(SKUPROJSTATIC.ITEM::VARCHAR,''),
'~',COALESCE(SKUPROJSTATIC.LOC::VARCHAR,''), 
'~', COALESCE(SKUPROJSTATIC.OPTIONSET::VARCHAR,''),
'~', COALESCE(SKUPROJSTATIC.STARTDATE::VARCHAR,''))) AS SUPPLY_PLNG_PROD_PROJECTION_KEY,
'BLUEYONDER' as  {{var('column_srcsyskey')}},  
MD5(UPPER(CONCAT(COALESCE(SKUPROJSTATIC.ITEM::VARCHAR,''),
'~',COALESCE(SKUPROJSTATIC.LOC::VARCHAR,''), 
'~', COALESCE(SKUPROJSTATIC.OPTIONSET::VARCHAR,''),
'~', COALESCE(SKUPROJSTATIC.STARTDATE::VARCHAR,'')))) AS {{var('column_rechashkey')}},
{{var('default_n')}} as {{var('column_DEL_FROM_SRC_FLAG')}},
'{{model.name}}' as {{var('column_ETL_INS_PID')}},
CURRENT_TIMESTAMP::TIMESTAMP_NTZ as {{var('column_ETL_INS_DTE')}},
'{{model.name}}' as {{var('column_ETL_UPD_PID')}},
CURRENT_TIMESTAMP::TIMESTAMP_NTZ as {{var('column_ETL_UPD_DTE')}},
SKUPROJSTATIC.LOADDTS as {{var('column_z3loddtm')}},
SKUPROJSTATIC.LOADDTS as  {{var('column_vereffdte')}},
'9999-12-31 00:00:00.000' as {{var('column_verexpirydt')}},
{{var('default_y')}} AS  {{var('column_currrecflag')}},                                                                                    
{{var('default_n')}} AS  {{var('column_orprecflag')}},
SKUPROJSTATIC.LOC  as LOC_KEY,
SKUPROJSTATIC.ITEM  as PROD_KEY,
SKUPROJSTATIC.OPTIONSET as STORE_SKU_PROJECTIONS_OPT_SET,
ROUND(TRIM(SKUPROJSTATIC.ACTUALINTRANSIN),5)  as ACT_IN_TRANSITS_IBND_QTY,
ROUND(SKUPROJSTATIC.ACTUALINTRANSOUT,5)  as ACT_IN_TRANSITS_OBND_QTY,
ROUND(SKUPROJSTATIC.ALLOCTOTFCST,5) as ALLOC_FCST_QTY,
ROUND(SKUPROJSTATIC.ALTCONSTRCOVDUR,0)  as ALT_CONSTRAINED_CVRG_DY_CNT,
ROUND(SKUPROJSTATIC.ADJFCSTCUSTORDERS,5)  as AUTO_FCST_CUST_ORD_QTY,
ROUND(SKUPROJSTATIC.COMMITINTRANSIN ,5) as COMMIT_LOD_QTY,
ROUND(SKUPROJSTATIC.CONSTRCOVDUR ,5) as CONSTRAINED_CVRG_DUR_DY_CNT,
SKUPROJSTATIC.CONSTRPROJAVAIL  as CONSTRAINED_PROJECTED_AVAIL,
ROUND(SKUPROJSTATIC.CONSTRPROJOH,5)  as CONSTRAINED_PROJECTED_ON_HAND,
ROUND(SKUPROJSTATIC.ALTCONSTRPOH ,5) as CONSTRAINED_PROJECTED_ON_HAND_QTY,
ROUND(SKUPROJSTATIC.TOTDMD ,5) as DMD_QTY,
ROUND(SKUPROJSTATIC.DEPDMD,5) as DPDNT_DMD_QTY,
ROUND(SKUPROJSTATIC.FIRMPLANSHIP,5) as FIRM_PLND_SHIP_AMT,
ROUND(SKUPROJSTATIC.TOTFCST ,5) as FCST_QTY,
ROUND(SKUPROJSTATIC.FCSTCUSTORDERS,5) as FORECASTS_CUST_ORD_QTY,
ROUND(SKUPROJSTATIC.TOTINTRANSIN ,5) as IN_TRANSITS_QTY,
ROUND(SKUPROJSTATIC.ADJALLOCTOTFCST ,5) as MKT_ACTVTY_FCST_QTY,
ROUND(SKUPROJSTATIC.NONFCSTCUSTORDERS ,5) as NON_FCSTD_CUST_ORD_QTY,
ROUND(SKUPROJSTATIC.TOTINTRANSOUT ,5) as OUT_TRANSITS_QTY,
ROUND(SKUPROJSTATIC.FIRMPLANORDER ,5) as FIRM_PLAN_ORD_QTY,
ROUND(SKUPROJSTATIC.PLANORDERS ,5) as PLAN_ORD_NBR,
ROUND(SKUPROJSTATIC.PLANARRIV ,5) as PLND_ARRIVALS_AMT,
ROUND(SKUPROJSTATIC.PLANPURCH ,5)  as PLND_PUR_QTY,
ROUND(SKUPROJSTATIC.PLANSHIP ,5) as PLND_SHIP_AMT,
ROUND(SKUPROJSTATIC.PRODREQUIREMENT ,5) as PRODTN_REQ_QTY,
SKUPROJSTATIC.PROJAVAIL  as PROJECTED_AVAIL_QTY,
Round(SKUPROJSTATIC.PROJOH, 5)  as PROJECTED_ON_HAND_QTY,
SKUPROJSTATIC.STARTDATE  as PROJECTION_START_DTE,
SKUPROJSTATIC.PROCESSDATE  as PROJECTIONS_PROC_DTE,
ROUND(SKUPROJSTATIC.RECARRIV ,5) as RECOMMENDED_ARRVL_SKU_QTY,
ROUND(SKUPROJSTATIC.RECSHIP,5) as RECOMMENDED_SHIP_QTY,
ROUND(SKUPROJSTATIC.SS ,5) as SFTY_STK_LVL_VAL,
ROUND(SKUPROJSTATIC.SCHEDRCPTS ,5)  as SCHED_RCPT_QTY,
ROUND(SKUPROJSTATIC.COVDUR,5)  as SKU_PROJECTION_DUR,
ROUND(SKUPROJSTATIC.TOTARRIV ,5) as SKU_PROJECTIONS_ARRVL_QTY,
ROUND(SKUPROJSTATIC.TOTSHIP,5) as SKU_PROJECTIONS_SHIP_QTY,
ROUND(SKUPROJSTATIC.STATSS ,5) as STATS_SFTY_STK_QTY,
ROUND(SKUPROJSTATIC.TOTSUPPLY ,5) as SUPPLY_QTY,
ROUND(SKUPROJSTATIC.DUR, 5)  as TM_INTV_DY_CNT,
ROUND(SKUPROJSTATIC.DFUTOSKUFCST ,5) as BASE_FCST_QTY,
ROUND(SKUPROJSTATIC.SKUEXTERNALFCST ,5) as EXT_FCST_QTY,
ROUND(SKUPROJSTATIC.NONBASEFCST ,5) as NON_BASE_FCST_QTY,
ROUND(SKUPROJSTATIC.INVENTORY ,5) as BOH_INV_QTY
FROM {{source('BLUEYONDER','SKUPROJSTATIC')}} SKUPROJSTATIC 
order by SKUPROJSTATIC.ITEM,SKUPROJSTATIC.LOC, SKUPROJSTATIC.OPTIONSET, SKUPROJSTATIC.STARTDATE )
select * from MAP
